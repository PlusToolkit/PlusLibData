 <PlusConfiguration version="2.1">
  <DataCollection StartupDelaySec="1.0" >
    <DeviceSet 
      Name="PlusServer: Ultrasound transverse process enhancer component 1: Input connection"
      Description="This 32 bit server runs on ultrasound machine, acquires images and tracking transforms, and transmits them to and OpenIGTLink client at port 18944 (with host address of machine running this server) in Slicer on the 64 bit processing machine"/>
    
    <Device 
      Id="TrackerDevice" 
      Type="Ascension3DG" 
      LocalTimeOffsetSec="0.0" 
      FilterAcWideNotch="1"
      ToolReferenceFrame="Tracker" >
      <DataSources>
        <DataSource Type="Tool" Id="Probe" PortName="0"  />
        <DataSource Type="Tool" Id="Reference" PortName="1"  />
      </DataSources>
      <OutputChannels>
        <OutputChannel Id="TrackerStream" >
          <DataSource Id="Probe"/>
          <DataSource Id="Reference"/>
        </OutputChannel>
      </OutputChannels>
    </Device>
    
    <Device
      Id="VideoDevice"
      Type="SonixVideo" 
      AcquisitionRate="30"
      Depth="100"
      AutoClipEnabled="TRUE"
      ImageGeometryOutputEnabled="TRUE"
      ImageToTransducerTransformName="ImageToProbe"
      IP="130.15.7.75" >
      <DataSources>
        <DataSource Type="Video" Id="Video" PortName="B" PortUsImageOrientation="UF"  />
      </DataSources>
      <OutputChannels>
        <OutputChannel Id="VideoStream" VideoDataSourceId="Video" />
      </OutputChannels>
    </Device>
  
    <Device 
      Id="TrackedVideoDevice" 
      Type="VirtualMixer" >
      <InputChannels>
        <InputChannel Id="TrackerStream" />
        <InputChannel Id="VideoStream" />
      </InputChannels>
      <OutputChannels>
        <OutputChannel Id="TrackedVideoStream"/>
      </OutputChannels>
    </Device>
  
    <!-- This device gives you the option to save sequences to files for testing offline. -->
    <Device
      Id="CaptureDevice"
      Type="VirtualCapture"
      BaseFilename="Recording.mha"
      EnableCapturingOnStart="FALSE" >
      <InputChannels>
        <InputChannel Id="VideoStream" />
      </InputChannels>
    </Device>

  </DataCollection>
  
  <!-- Enable this Server's port in Slicer to see the input image along with the processed image -->
  <PlusOpenIGTLinkServer 
    MaxNumberOfIgtlMessagesToSend="1" 
    MaxTimeSpentWithProcessingMs="50" 
    ListeningPort="18944" 
    SendValidTransformsOnly="true" 
    OutputChannelId="TrackedVideoStream" > 
    <DefaultClientInfo> 
      <MessageTypes> 
        <Message Type="IMAGE" />
        <Message Type="TRANSFORM" />
      </MessageTypes>

      <TransformNames> 
        <Transform Name="ProbeToTracker" />
        <Transform Name="ReferenceToTracker" />
        <Transform Name="ProbeToReference" />
      </TransformNames>
      
      <ImageNames>
        <Image Name="Image" EmbeddedTransformToFrame="Reference" /> <!-- Changing EmbeddedTransformToFrame from "Transducer" to "Reference" results in image appearing with tracking in Slicer automatically, though not under sent transform heirarchy -->
      </ImageNames>
      
    </DefaultClientInfo>
  </PlusOpenIGTLinkServer>
  
</PlusConfiguration>